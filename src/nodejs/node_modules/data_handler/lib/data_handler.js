var data = require('data'),
    utils = require('utils'),
    herodata = require('hero_data');


function getEntity(path) {
  console.log(path);
  var entity = path.replace(/^\/(.*?)\/.*$/, "$1");
  console.log("Entity : "+entity);
  return entity;
}

exports.handlerGetAll = function (req, res) {
  res.set("Content-Type", "application/json");
  console.log("\n\n-----------------------------------------\n\n");
  console.log("Get All Query");
  console.log(req.query);
  res.send(utils.retResult(herodata.heroData));
};

exports.handlerGet = function (req, res) {
  res.set("Content-Type", "application/json");
  console.log("\n\n-----------------------------------------\n\n");
  console.log("Get Query");
  console.log(req.query);
  data.getData(getEntity(req.path), req.query, function(retData) {
    console.log("Returning Data");
    res.send(retData);
  });
};

exports.handlerCreate = function (req, res) {
  res.set("Content-Type", "application/json");
  console.log("\n\n-----------------------------------------\n\n");
  console.log("Create Query");
  console.log(req.body);
  var postParams = req.body;
  try {
    console.log("Calling update");
    data.createData(getEntity(req.path), postParams.data, function(retData) {
      console.log("Returning Data");
      res.send(retData);
    });
  }
  catch(err) {
    console.log(err);
    res.send(utils.retError(err));
  }
};

exports.handlerUpdate = function (req, res) {
  res.set("Content-Type", "application/json");
  console.log("\n\n-----------------------------------------\n\n");
  console.log("Update Query");
  console.log(req.body);
  var postParams = req.body;
  try {
    console.log("Calling update");
    data.updateData(getEntity(req.path), postParams.data, function(retData) {
      console.log("Returning Data");
      res.send(retData);
    });
  }
  catch(err) {
    console.log(err);
    res.send(utils.retError(err));
  }
};
